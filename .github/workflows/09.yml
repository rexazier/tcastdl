name: 09-DL-P
on: 
  workflow_dispatch:
    inputs:
      url:
        required: true
        description: URL for yt-dlp
      name:
        required: true
        description: filename
      audio_only:
        type: boolean
        description: Audio-only
        default: false
      video_only:
        type: boolean
        description: Video-only
        default: false
      discord:
        type: boolean
        description: sent to Discord 
        default: true
      ftp_only:
        type: boolean
        description: FTP-ONLY
        default: false
jobs:
  Y-DL:
    runs-on: ubuntu-latest
    steps :
    - uses: actions/checkout@v2
    - name: Installing
      run : |
        sudo apt update -y
        sudo wget -q 'https://github.com/yt-dlp/yt-dlp/releases/latest/download/yt-dlp' -O /usr/local/bin/yt-dlp
        sudo chmod a+rx /usr/local/bin/yt-dlp
        sudo chmod a+rx ytarchive
        sudo cp ytarchive /usr/local/bin/ytarchive
        sudo chmod a+rx go-ul
        sudo cp go-ul /usr/local/bin/go-ul
        sudo wget -q 'https://github.com/BtbN/FFmpeg-Builds/releases/download/latest/ffmpeg-master-latest-linux64-gpl.tar.xz'
        sudo tar xvf ffmpeg-master-latest-linux64-gpl.tar.xz
        sudo chmod a+rx ffmpeg-master-latest-linux64-gpl/bin/ffmpeg ffmpeg-master-latest-linux64-gpl/bin/ffprobe
        sudo mv ffmpeg-master-latest-linux64-gpl/bin/ffmpeg ffmpeg-master-latest-linux64-gpl/bin/ffprobe /usr/local/bin/
        sudo rm -rf ffmpeg-master-latest-linux64-gpl ffmpeg-master-latest-linux64-gpl.tar.xz
        echo ${{github.event.inputs.name}} ${{github.event.inputs.url}} > output/link.txt
        sudo mkdir Y
    - name: Downloading ${{github.event.inputs.name}} ${{github.event.inputs.url}}
      if  : ${{ github.event.inputs.video_only == 'true' }}
      timeout-minutes: 360
      run : sudo yt-dlp --merge-output mkv -P Y --downloader-args "ffmpeg:-v error" ${{github.event.inputs.url}}
    - name: Downloading ${{github.event.inputs.name}} ${{github.event.inputs.url}} audio-only
      if  : ${{ github.event.inputs.audio_only == 'true' }}
      timeout-minutes: 360
      run : sudo yt-dlp -f bestaudio --merge-output mka -P Y --downloader-args "ffmpeg:-v error" ${{github.event.inputs.url}}
    - name: Uploading to FTP
      if  : ${{(github.event.inputs.ftp_only == 'true') && (github.event.inputs.video_only == 'true')}}
      timeout-minutes: 240
      env :
        VOE_FTP: ${{ secrets.VOE_FTP }}
      run : |
        go-ul ftp -d 'Y' -r -u '${{ env.VOE_FTP }}/DLP' -O
    - name: Uploading 
      if  : ${{ github.event.inputs.ftp_only == 'false' }}
      timeout-minutes: 240
      env :
        VOE_FTP: ${{ secrets.VOE_FTP }}
      run : |
        go-ul ftp -d 'Y' -r -u '${{ env.VOE_FTP }}/DLP' -O -o output/link.txt
        go-ul pixeldrain anonfiles gofile catbox -d 'Y' -r -o output/link.txt
    - name: Archive ${{github.event.inputs.name}}s link.txt
      if  : ${{ github.event.inputs.ftp_only == 'false' }}
      uses: actions/upload-artifact@v3
      with:
        name: ${{github.event.inputs.name}}
        path: output/*.txt
    - name: Send file to discord
      if  : ${{ (github.event.inputs.discord == 'true') || github.event.inputs.ftp_only == 'true' }}
      uses: sinshutu/upload-to-discord@master
      env :
        DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
      with:
        args: output/*.txt
